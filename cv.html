<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Curriculum Vitae | JuanMa Sierra García</title>
</head>
<body>
  <main>
    <h1>Curriculum Vitae</h1>

    <section id="titulos">
      <h2>Títulos Oficiales</h2>
      <ul id="lista-titulos"></ul>
    </section>

    <section id="otros-certificados">
      <h2>Otros Certificados por Área</h2>
      <div id="area-informatica">
        <h3>Informática</h3>
        <ul id="lista-informatica"></ul>
      </div>
      <div id="area-idiomas">
        <h3>Idiomas</h3>
        <ul id="lista-idiomas"></ul>
      </div>
      <div id="area-ciencias">
        <h3>Ciencias</h3>
        <ul id="lista-ciencias"></ul>
      </div>
      <div id="area-otros">
        <h3>Otros</h3>
        <ul id="lista-otros"></ul>
      </div>
    </section>

    <section id="no-publicados">
      <h2>Certificados no publicados</h2>
      <ul id="lista-no-publicados"></ul>
    </section>

    <p><a href="index.html">← Volver a la página principal</a></p>
  </main>

  <script>
    const SHEET_ID = '1A2qHdYFzmOcLU4-xqKwREIbchy-H3CRWzin_Ht2GV9k';
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    fetch(SHEET_URL)
      .then(res => res.ok ? res.text() : Promise.reject("Error al cargar la hoja"))
      .then(text => {
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows;

        const listaTitulos = document.getElementById("lista-titulos");
        const listaInformatica = document.getElementById("lista-informatica");
        const listaIdiomas = document.getElementById("lista-idiomas");
        const listaCiencias = document.getElementById("lista-ciencias");
        const listaOtros = document.getElementById("lista-otros");
        const listaNoPublicados = document.getElementById("lista-no-publicados");

        rows.forEach(row => {
          const [
            titulo, entidad, fecha, area, tipo, publicado, url, notas
          ] = row.c.map(c => c?.v || "");

          const anio = fecha ? new Date(fecha).getFullYear() : "";
          const texto = `${titulo} (${anio}) - ${entidad}`;
          const li = document.createElement("li");

          // Prepara para mostrar URL más adelante
          li.textContent = texto;
          if (url) {
            const enlace = document.createElement("a");
            enlace.href = url;
            enlace.target = "_blank";
            enlace.textContent = " [Ver certificado]";
            li.appendChild(enlace);
          }

          if (publicado.toLowerCase() === "si") {
            if (tipo.toLowerCase() === "título") {
              listaTitulos.appendChild(li);
            } else {
              switch (area.toLowerCase()) {
                case "informática":
                  listaInformatica.appendChild(li);
                  break;
                case "idiomas":
                  listaIdiomas.appendChild(li);
                  break;
                case "ciencias":
                  listaCiencias.appendChild(li);
                  break;
                default:
                  listaOtros.appendChild(li);
              }
            }
          } else {
            listaNoPublicados.appendChild(li);
          }
        });
      })
      .catch(error => {
        console.error("Error cargando hoja: ", error);
        document.getElementById("lista-titulos").innerHTML = "<li>No se pudo cargar el CV.</li>";
      });
  </script>
</body>
</html>
