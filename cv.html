<script>
  const SHEET_ID = '1A2qHdYFzmOcLU4-xqKwREIbchy-H3CRWzin_Ht2GV9k';
  const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

  fetch(SHEET_URL)
    .then(res => res.ok ? res.text() : Promise.reject("Failed to load spreadsheet"))
    .then(text => {
      const json = JSON.parse(text.substr(47).slice(0, -2));
      const rows = json.table.rows;
      const headers = json.table.cols.map(col => col.label.trim());

      const colIndex = {
        english: headers.indexOf("English"),
        institution: headers.indexOf("Institution"),
        year: headers.indexOf("Year"),
        area: headers.indexOf("Area"),
        type: headers.indexOf("Type"),
        published: headers.indexOf("Published"),
        url: headers.indexOf("URL")
      };

      const listDegrees   = document.getElementById("list-degrees");
      const listLanguages = document.getElementById("list-languages");
      const listIT        = document.getElementById("list-it");
      const listScience   = document.getElementById("list-science");
      const listMisc      = document.getElementById("list-misc");

      rows.forEach(row => {
        const titleEN   = row.c[colIndex.english]?.v || "";
        const entity    = row.c[colIndex.institution]?.v || "";
        const year      = row.c[colIndex.year]?.v || "";
        const area      = (row.c[colIndex.area]?.v || "").toLowerCase();
        const type      = (row.c[colIndex.type]?.v || "").toLowerCase();
        const published = (row.c[colIndex.published]?.v || "").toLowerCase();
        const url       = row.c[colIndex.url]?.v || "";

        if (published !== "yes") return; // solo mostrar certificados publicados

        const displayText = `${titleEN} (${year}) - ${entity}`;
        const li = document.createElement("li");
        li.textContent = displayText;

        if (url) {
          const link = document.createElement("a");
          link.href = url;
          link.target = "_blank";
          link.textContent = " [View certificate]";
          li.appendChild(link);
        }

        if (type === "tÃ­tulo") {
          listDegrees.appendChild(li);
        } else if (area === "languages") {
          listLanguages.appendChild(li);
        } else {
          switch (area) {
            case "computer science":
              listIT.appendChild(li);
              break;
            case "science":
              listScience.appendChild(li);
              break;
            default:
              listMisc.appendChild(li);
          }
        }
      });
    })
    .catch(error => {
      console.error("Error loading CV: ", error);
      document.getElementById("list-degrees").innerHTML = "<li>Could not load CV data.</li>";
    });
</script>
