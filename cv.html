<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Juan Manuel Sierra García">


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

    <title>JuanMa Sierra García | Andalucia - Asturias - Oporto</title>

    <link rel="icon" href="favicon.ico" type="image/png"/>

    <link href="https://fonts.googleapis.com/css?family=Reem+Kufi|Roboto:300" rel="stylesheet">
    <script src="https://kit.fontawesome.com/8bcd15b62e.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/themes/yellow-black.css">

<body>
	<main>
		<h1 class="intro">Curriculum Vitae</h1>
		<p class="tagline">List of verified academic and professional credentials</p>

		<section id="cv-content">
			<!-- Aquí se insertará dinámicamente el contenido desde Google Sheets -->
		</section>

		<footer style="margin-top: 2rem;">
			<a href="index.html">← Back to main page</a>
		</footer>
	</main>

	<script>
		const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQiX1Y5TdHO8BVWX2-vpCiUt8dMlnJeu13QtTJKihzewAvF5EmVU4PZrEWW8mx5GaeLxV_jBbwBXDos/gviz/tq?tqx=out:json';

		fetch(url)
			.then(response => response.text())
			.then(text => JSON.parse(text.substr(47).slice(0, -2)))
			.then(data => {
				const rows = data.table.rows;
				const types = {};

				// Agrupar por tipo
				for (const row of rows) {
					const c = row.c;
					if (!c || c[6].v !== 'YES') continue;

					const type = c[5].v;
					const title = c[1]?.v || '[No Title]';
					const institution = c[2]?.v || '[No Institution]';
					const year = c[3]?.v || '';
					const url = c[7]?.v || '';
					
					if (!types[type]) types[type] = [];
					types[type].push({ title, institution, year, url });
				}

				const container = document.getElementById('cv-content');

				Object.keys(types).forEach(type => {
					const section = document.createElement('section');
					section.innerHTML = `<h2 style="margin-top:2rem">${type}</h2>`;
					
					const ul = document.createElement('ul');
					ul.style.listStyle = 'none';
					ul.style.padding = 0;

					types[type].sort((a, b) => b.year - a.year).forEach(item => {
						const li = document.createElement('li');
						const urlText = item.url ? ` – <a href="${item.url}" target="_blank">View certificate</a>` : '';
						li.innerHTML = `<strong>${item.title}</strong> (${item.year}) — ${item.institution}${urlText}`;
						li.style.marginBottom = '1rem';
						ul.appendChild(li);
					});

					section.appendChild(ul);
					container.appendChild(section);
				});
			});
	</script>
</body>
</html>
