<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="author" content="Juan Manuel Sierra García">
      <title>Curriculum Vitae | JuanMa Sierra García</title>
      <link rel="icon" href="favicon.ico" type="image/png" />
      <!-- Google Fonts -->
      <link href="https://fonts.googleapis.com/css?family=Reem+Kufi|Roboto:300" rel="stylesheet">
      <!-- Bootstrap & FontAwesome -->
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
      <script src="https://kit.fontawesome.com/8bcd15b62e.js" crossorigin="anonymous"></script>
      <!-- Custom Styles -->
      <link rel="stylesheet" href="css/reset.css">
      <link rel="stylesheet" href="css/styles.css">
      <link rel="stylesheet" href="css/themes/yellow-black.css">
   </head>
   <body>
      <main>
         <div style="text-align: right; margin: 10px 20px;">
            <button id="toggle-lang" class="btn btn-default">Español</button>
         </div>
         <div class="container">
            <h1 class="intro">Curriculum Vitae</h1>
            <section>
               <h2 class="tagline">Official Degrees</h2>
               <ul id="list-degrees" class="cv-list"></ul>
            </section>
            <section>
               <h2 class="tagline">Languages</h2>
               <ul id="list-languages" class="cv-list"></ul>
            </section>
            <section>
               <h2 class="tagline">Other Certificates</h2>
               <div>
                  <h3>Computer Science</h3>
                  <ul id="list-it" class="cv-list"></ul>
               </div>
               <div>
                  <h3>Science</h3>
                  <ul id="list-science" class="cv-list"></ul>
               </div>
               <div>
                  <h3>Other</h3>
                  <ul id="list-misc" class="cv-list"></ul>
               </div>
            </section>
            <p class="parrafo"><a href="index.html">← Back to main page</a></p>
         </div>
      </main>
      <script>
         const SHEET_ID = '1A2qHdYFzmOcLU4-xqKwREIbchy-H3CRWzin_Ht2GV9k';
         const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
         
         let currentLang = "en"; // Default
         
         const sectionTitles = {
           en: {
             degrees: "Official Degrees",
             languages: "Languages",
             certificates: "Other Certificates",
             cs: "Computer Science",
             sci: "Science",
             misc: "Other",
             back: "← Back to main page",
             langBtn: "Español"
           },
           es: {
             degrees: "Titulaciones Oficiales",
             languages: "Idiomas",
             certificates: "Otros Certificados",
             cs: "Informática",
             sci: "Ciencias",
             misc: "Otros",
             back: "← Volver a la página principal",
             langBtn: "English"
           }
         };
         
         function renderCV(data, lang = "en") {
           const headers = data.table.cols.map(col => col.label.trim());
           const rows = data.table.rows;
         
           const colIndex = {
             spanish: headers.indexOf("Spanish"),
             english: headers.indexOf("English"),
             institution: headers.indexOf("Institution"),
             year: headers.indexOf("Year"),
             area: headers.indexOf("Area"),
             type: headers.indexOf("Type"),
             published: headers.indexOf("Published"),
             url: headers.indexOf("URL")
           };
         
           const get = (row, idx) => row.c[idx]?.v || "";
         
           const listDegrees   = document.getElementById("list-degrees");
           const listLanguages = document.getElementById("list-languages");
           const listIT        = document.getElementById("list-it");
           const listScience   = document.getElementById("list-science");
           const listMisc      = document.getElementById("list-misc");
         
           [listDegrees, listLanguages, listIT, listScience, listMisc].forEach(ul => ul.innerHTML = "");
         
           rows.forEach(row => {
             if ((get(row, colIndex.published) || "").toLowerCase() !== "yes") return;
         
             const title = lang === "es" ? get(row, colIndex.spanish) : get(row, colIndex.english);
             const inst = get(row, colIndex.institution);
             const year = get(row, colIndex.year);
             const area = (get(row, colIndex.area) || "").toLowerCase();
             const type = (get(row, colIndex.type) || "").toLowerCase();
             const url  = get(row, colIndex.url);
         
             const li = document.createElement("li");
         
             li.innerHTML = `
               <span class="cv-title">${title}</span>. 
               <span class="cv-institution">${inst}</span> 
               (<span class="cv-year">${year}</span>)
               ${url ? `<a href="${url}" target="_blank"> [${lang === "es" ? "Ver certificado" : "View certificate"}]</a>` : ""}
             `;
         
             if (type === "título") {
               listDegrees.appendChild(li);
             } else if (area === "languages") {
               listLanguages.appendChild(li);
             } else {
               switch (area) {
                 case "computer science":
                 case "informática":
                   listIT.appendChild(li);
                   break;
                 case "science":
                 case "ciencias":
                   listScience.appendChild(li);
                   break;
                 default:
                   listMisc.appendChild(li);
               }
             }
           });
         
           document.querySelector("#degrees h2").textContent = sectionTitles[lang].degrees;
           document.querySelector("#languages h2").textContent = sectionTitles[lang].languages;
           document.querySelector("#other-certificates h2").textContent = sectionTitles[lang].certificates;
           document.querySelector("#area-it h3").textContent = sectionTitles[lang].cs;
           document.querySelector("#area-science h3").textContent = sectionTitles[lang].sci;
           document.querySelector("#area-misc h3").textContent = sectionTitles[lang].misc;
           document.querySelector("main p a").textContent = sectionTitles[lang].back;
           document.getElementById("toggle-lang").textContent = sectionTitles[lang].langBtn;
         }
         
         fetch(SHEET_URL)
           .then(res => res.ok ? res.text() : Promise.reject("Failed to load spreadsheet"))
           .then(text => {
             const json = JSON.parse(text.substr(47).slice(0, -2));
             renderCV(json, currentLang);
         
             document.getElementById("toggle-lang").addEventListener("click", () => {
               currentLang = currentLang === "en" ? "es" : "en";
               renderCV(json, currentLang);
             });
           })
           .catch(error => {
             console.error("Error loading CV: ", error);
             document.getElementById("list-degrees").innerHTML = "<li>Could not load CV data.</li>";
           });
      </script>
      <style>
         .container {
         max-width: 800px;
         margin: 0 auto;
         padding: 2rem 1rem;
         }
         .cv-list {
         list-style-type: none;
         padding-left: 0;
         margin-bottom: 2rem;
         }
         .cv-list li {
         font-size: 1.1em;
         margin-bottom: 1rem;
         line-height: 1.5;
         text-align: left;
         }
         .cv-meta {
         font-style: italic;
         font-weight: 300;
         }
         .cv-type {
         font-style: italic;
         color: #444;
         margin-left: 0.3em;
         font-size: 0.95em;
         }
         h1.intro {
         font-size: 2.5rem;
         text-align: center;
         margin-bottom: 1rem;
         }
         h2.tagline {
         font-size: 1.75rem;
         border-bottom: 2px solid #000;
         padding-bottom: 0.2rem;
         margin-top: 3rem;
         font-family: 'Reem Kufi', sans-serif;
         }
         h3 {
         font-size: 1.3rem;
         margin-top: 2rem;
         font-family: 'Reem Kufi', sans-serif;
         }
         a {
         text-decoration: underline;
         }
         .cv-title {
         font-weight: bold;
         }
         .cv-institution {
         font-style: italic;
         }
         .cv-year {
         color: #666;
         }
      </style>
   </body>
</html>
